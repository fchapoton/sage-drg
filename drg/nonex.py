# -*- coding: utf-8 -*-
from .util import frac
from .util import symbol

sporadic = {
    ("p", ((14, 12), (1, 4))): "WilbrinkBrouwer83",
    ("p", ((16, 12), (1, 6))): "BHMW89",
    ("p", ((21, 18), (1, 7))): "Haemers93",
    ("p", ((30, 21), (1, 14))): "BPR17",
    ("p", ((32, 21), (1, 16))): "AzarijaMarc18",
    ("p", ((38, 27), (1, 18))): "Degraer07",
    ("p", ((40, 27), (1, 20))): "AzarijaMarc16",
    ("p", ((57, 56), (1, 12))): "GavrilyukMakhnev05",
    ("p", ((67, 56), (1, 2))): "BrouwerNeumaier81",
    ("p", ((116, 115), (1, 20))): "Makhnev17",
    ("p", ((153, 120), (1, 60))): "BMPRV18",
    ("p", ((165, 128), (1, 66))): "Makhnev02",
    ("p", ((486, 320), (1, 243))): "Makhnev02",
    ("p", ((5, 4, 3), (1, 1, 2))): "Fon-Der-Flaass93b",
    ("p", ((11, 10, 10), (1, 1, 11))): "LTS89",
    ("p", ((13, 10, 7), (1, 2, 7))): "Coolsaet95",
    ("p", ((18, 12, 1), (1, 2, 18))): [("BCN", "Prop. 12.5.2."),
                                       ("PayneThas", "6.2.2.")],
    ("p", ((20, 10, 10), (1, 1, 2))): "LTS89",
    ("p", ((21, 16, 8), (1, 4, 14))): "Coolsaet05",
    ("p", ((22, 16, 5), (1, 2, 20))): "SumalrojWorawannotai16",
    ("p", ((27, 20, 10), (1, 2, 18))): "BSW16",
    ("p", ((36, 28, 4), (1, 2, 24))): "BSW16",
    ("p", ((39, 24, 1), (1, 4, 39))): "BGK18",
    ("p", ((45, 30, 7), (1, 2, 27))): "GavrilyukMakhnev13",
    ("p", ((52, 35, 16), (1, 4, 28))): "GavrilyukMakhnev12",
    ("p", ((55, 36, 11), (1, 4, 45))): "Gavrilyuk11",
    ("p", ((56, 36, 9), (1, 3, 48))): "Gavrilyuk11",
    ("p", ((69, 48, 24), (1, 4, 46))): "GavrilyukMakhnev12",
    ("p", ((74, 54, 15), (1, 9, 60))): u"CoolsaetJurišić08",
    ("p", ((80, 54, 12), (1, 6, 60))): "KIPR18",
    ("p", ((83, 54, 21), (1, 6, 63))): "GVW19",
    ("p", ((104, 70, 25), (1, 7, 80))): "GVW19",
    ("p", ((105, 102, 99), (1, 2, 35))): "DeBruynVanhove15",
    ("p", ((125, 108, 24), (1, 9, 75))): "GVW19",
    ("p", ((126, 90, 10), (1, 6, 105))): "GVW19",
    ("p", ((130, 96, 18), (1, 12, 117))): u"JurišićVidali17",
    ("p", ((135, 128, 16), (1, 16, 120))): "Vidali18",
    ("p", ((195, 160, 28), (1, 20, 168))): "GVW19",
    ("p", ((203, 160, 34), (1, 16, 170))): "GVW19",
    ("p", ((234, 165, 12), (1, 30, 198))): "Vidali18",
    ("p", ((4818, 4248, 192), (1, 72, 4672))): u"JurišićVidali17",
    ("p", ((5928, 5920, 5888), (1, 5, 741))): "DeBruynVanhove15",
    ("p", ((120939612, 120939520, 120933632), (1, 65, 1314561))):
        "DeBruynVanhove15",
    ("p", ((97571175, 97571080, 97569275), (1, 20, 1027065))):
        "DeBruynVanhove15",
    ("p", ((290116365, 290116260, 290100825), (1, 148, 2763013))):
        "DeBruynVanhove15",
    ("p", ((5, 4, 3, 3), (1, 1, 1, 2))): "Fon-Der-Flaass93a",
    ("p", ((10, 9, 1, 1), (1, 1, 9, 10))): ("BCN", "Prop. 11.4.5."),
    ("p", ((32, 27, 6, 1), (1, 6, 27, 32))): "Soicher17",
    ("p", ((32, 27, 9, 1), (1, 3, 27, 32))): "Soicher17",
    ("p", ((53, 40, 28, 16), (1, 4, 10, 28))): "GVW19",
    ("p", ((56, 45, 20, 1), (1, 4, 45, 56))): ("BCN94", "Thm. 11.4.6."),
    ("p", ((55, 54, 50, 35, 10), (1, 5, 20, 45, 55))): "Vidali18",
    ("p", ((15, 14, 12, 6, 1, 1), (1, 1, 3, 12, 14, 15))):
        "IvanovShpectorov90",
    ("q", ((24, 20, frac(36, 11)), (1, frac(30, 11), 24))): "GVW19"
}

r = symbol("__r")
t = symbol("__t")

families = {
    ("p", ((r**2*(r+3), (r+1)*(r**2+2*r-2)), (1, r*(r+1)))):
        ([r >= 3, r != 4], "BondarenkoRadchenko13"),
    ("p", (((2*r**2 - 1)*(2*r+1), 4*r*(r**2-1), 2*r**2),
     (1, 2*(r**2-1), r*(4*r**2-2)))): (r >= 2, u"JurišićVidali12"),
    ("p", ((2*r**2*(2*r+1), (2*r-1)*(2*r**2+r+1), 2*r**2),
     (1, 2*r**2, r*(4*r**2-1)))): (r >= 2, u"JurišićVidali12"),
    ("p", ((4*r**3 + 8*r**2 + 6*r + 1, 2*r*(r+1)*(2*r+1), 2*r**2 + 2*r + 1),
     (1, 2*r*(r+1), (2*r+1)*(2*r**2+2*r+1)))): (r >= 1, u"CoolsaetJurišić08"),
    ("p", (((2*r+1)*(4*r+1)*(4*t-1), 8*r*(4*r*t-r+2*t), (r+t)*(4*r+1)),
     (1, (r+t)*(4*r+1), 4*r*(2*r+1)*(4*t-1)))): ([r >= 1, t >= 1], "Vidali18"),
    ("p", (((r+1)*(r**3-1), r*(r-1)*(r**2+r-1), r**2-1),
     (1, r*(r+1), (r**2-1)*(r**2+r-1)))): (r >= 3, "Urlep12"),
    ("p", ((r**2*(r*t+t+1), (r**2-1)*(r*t+1), r*(r-1)*(t+1), 1),
     (1, r*(t+1), (r**2-1)*(r*t+1), r**2*(r*t+t+1)))):
         ([r >= 3, (r != 3, [t != 1, t != 3]), (r != 4, t != 2)],
          u"JurišićKoolen11"),
    ("p", ((2*r**2+r, 2*r**2+r-1, r**2, r, 1),
           (1, r, r**2, 2*r**2+r-1, 2*r**2+r))):
        (r >= 2, "CJK08"),
    ("q", ((8*r**2+8*r+1, 8*r**2+8*r, 4*r**2+4*r+2), (1, 2, 4*r**2+4*r))):
        (r >= 1, "GVW19"),
    ("q", ((r**2-4, r**2-9, 9, 1), (1, 3, r**2-9, r**2-4))):
        (r >= 5, "GSV18"),
    ("q", ((2*r+1, 2*r, 4*(2*r+1)*(t**2+t)/(2*t+1)**2, 2*r-4*t**2-4*t+1),
           (1, (2*r+1)/(2*t+1)**2, 4*t**2+4*t, 2*r+1))):
        ([r >= 1, t >= 1], "GVW19"),
    ("q", ((8*r**2-4*r+1, 4*r*(2*r-1), (8*r**2-4*r+1)**2/(2*r*(4*r-1)),
            (8*r**2-4*r+1)*(2*r-1)/(4*r-1), (8*r**2-4*r+1)/(4*r-1)),
           (1, (8*r**2-4*r+1)*(2*r-1)/(2*r*(4*r-1)),
            2*r*(8*r**2-4*r+1)/(4*r-1), 2*(8*r**2-4*r+1)*(2*r-1)/(4*r-1),
            8*r**2-4*r+1))): (r >= 2, "GVW19")
}

classicalFamilies = {
    (t, -2, -2, ((-2)**(t+1) - 1)/3): (t >= 4, "HPW15"),
    (t, -r, -r/(r-1), r + r**2 * ((-r)**(t-1) - 1) / (r**2-1)):
        ([r >= 2, t >= 4], "DeBruynVanhove15")
}


def checkConditions(cond, sol):
    """
    Check whether the given conditions hold for the given values of variables.
    """
    if isinstance(cond, list):
        return all(checkConditions(cnd, sol) for cnd in cond)
    elif isinstance(cond, tuple):
        return any(checkConditions(cnd, sol) for cnd in cond)
    else:
        return cond.subs(sol)
